<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="A tutorial about how to clean or filter raw tracking data using the MoveR package.">
<title>Clean/Filter Data • MoveR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.6/font.css" rel="stylesheet">
<link href="../deps/JetBrains_Mono-0.4.6/font.css" rel="stylesheet">
<link href="../deps/Roboto_Slab-0.4.6/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Clean/Filter Data">
<meta property="og:description" content="A tutorial about how to clean or filter raw tracking data using the MoveR package.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-default navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">MoveR</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">
    <span class="fa fa-file-code-o"></span>
     
    Functions
  </a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown--how-to">
    <span class="fas fa fas fa-book"></span>
     
    How To
  </a>
  <div class="dropdown-menu" aria-labelledby="dropdown--how-to">
    <a class="dropdown-item" href="../articles/MoveR-ImportData.html">Import Data</a>
    <a class="dropdown-item" href="../articles/MoveR-Clean-FilterData.html">Clean/Filter Data</a>
    <a class="dropdown-item" href="../articles/MoveR-ComputeMetrics.html">Compute some metrics</a>
    <a class="dropdown-item" href="../articles/MoveR-PatternId.html">Sequences identification</a>
    <a class="dropdown-item" href="../articles/MoveR-ParallelComputation.html">Parallel computing</a>
    <a class="dropdown-item" href="../articles/MoveR-SensitivityAnalysis.html">Detection performances</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">
    <span class="fas fa fas fa-history"></span>
     
    Changelog
  </a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="nav-link" href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/qpetitjean/MoveR/">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">


<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Clean/Filter Data</h1>
            
            <h4 data-toc-skip class="date">2023-06-01</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/qpetitjean/MoveR/blob/HEAD/vignettes/MoveR-Clean-FilterData.Rmd" class="external-link"><code>vignettes/MoveR-Clean-FilterData.Rmd</code></a></small>
      <div class="d-none name"><code>MoveR-Clean-FilterData.Rmd</code></div>
    </div>

    
    
<p><a href="https://qpetitjean.github.io/MoveR/articles/MoveR-ImportData.html" class="external-link previous">« Previous</a><a href="https://qpetitjean.github.io/MoveR/articles/MoveR-ComputeMetrics.html" class="external-link next">Next »</a><br></p>
<p>Now that we are familiar with importing raw data from tracking software, we are focusing on how to clean/filter them.</p>
<p>For this example we are selecting the second sample of data available in the <a href="https://github.com/qpetitjean/MoveR_SampleData" class="external-link">MoveR_SampleData</a> github repository.</p>
<p>Briefly, this dataset comes from the video recording (image resolution: 1920x1080) of 24 parasitic micro-wasp individuals (genus <i>Trichogramma</i>) placed in a thermostated circular arena (2.5cm diameter, see Ion Scotta et al., 2021) for 110 minutes at 25 fps (see fig. <a href="#fig:VideoPics">1</a> left panel).</p>
<p>Over the exposure duration individuals has been exposed to a steady increases in temperature from 18℃ to 45℃ followed by a steady decreases from 45℃ to 18℃ (temperature changing rate: 0.5℃ per minutes). Individuals were then tracked using <a href="https://trex.run" class="external-link">TRex</a> (Walter and Couzin, 2021).</p>
<p>To reduce space allocation and computing time we reduced the dataset by removing the movements recorded below 35℃ (see fig. <a href="#fig:VideoPics">1</a> right panel).</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:VideoPics"></span>
<img src="https://github.com/qpetitjean/MoveR_SampleData/raw/main/sample_2/2021-03-01-ISA17150-chaud.gif" alt=" Frames extracted from a video recording of 24 parasitic micro-wasps (genus &lt;em&gt;Trichogramma&lt;/em&gt;) placed in a thermostated circular arena (left). Temperature ramp over which the movements of parasitic micro-wasp were recorded. The shaded area corresponds to the part of the data removed from the original dataset (i.e., moments where temperature was below 35&amp;#8451;) while the white area correspond to the remaining data used in the following exemple (right)." width="49%"><img src="https://github.com/qpetitjean/MoveR_SampleData/raw/main/sample_2/Sample2_ReducedData.png" alt=" Frames extracted from a video recording of 24 parasitic micro-wasps (genus &lt;em&gt;Trichogramma&lt;/em&gt;) placed in a thermostated circular arena (left). Temperature ramp over which the movements of parasitic micro-wasp were recorded. The shaded area corresponds to the part of the data removed from the original dataset (i.e., moments where temperature was below 35&amp;#8451;) while the white area correspond to the remaining data used in the following exemple (right)." width="49%"><p class="caption">
Figure 1:  Frames extracted from a video recording of 24 parasitic micro-wasps (genus <em>Trichogramma</em>) placed in a thermostated circular arena (left). Temperature ramp over which the movements of parasitic micro-wasp were recorded. The shaded area corresponds to the part of the data removed from the original dataset (i.e., moments where temperature was below 35℃) while the white area correspond to the remaining data used in the following exemple (right).
</p>
</div>
<div class="section level2">
<h2 id="import-sample-data-from-github">Import sample data from github<a class="anchor" aria-label="anchor" href="#import-sample-data-from-github"></a>
</h2>
<p>Let’s download the data, import and convert them to a list of tracklets (see the <a href="https://qpetitjean.github.io/MoveR/articles/MoveR-ImportData.html" class="external-link">Import Data vignette</a> for detailed procedure).</p>
<p class="notes">
Note that we have included some extra data that are related to this dataset within the “raw tracking data” when we have reduced the dataset:<br></p>
<li>
the timeline expressed in frame (may be different from the default frame list because the data comes from merged videos)
</li>
<br><li>
the temperature at which the individuals are exposed over the assay.
</li>
<br> These extra information will be useful to conduct further analyses in this tutorial and some others.<br> For instance, we can automatically determine the frame rate of the video-recording using the timeline and timestamps (usually made using the default frame list instead of timeline).

<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># dl the second dataset from the sample data repository</span></span>
<span><span class="va">Path2Data</span> <span class="op">&lt;-</span> <span class="fu">MoveR</span><span class="fu">::</span><span class="fu"><a href="../reference/DLsampleData.html">DLsampleData</a></span><span class="op">(</span>dataSet <span class="op">=</span> <span class="fl">2</span>, tracker <span class="op">=</span> <span class="st">"TRex"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Import the sample data</span></span>
<span><span class="va">TRexDat</span> <span class="op">&lt;-</span> <span class="fu">MoveR</span><span class="fu">::</span><span class="fu"><a href="../reference/readTrex.html">readTrex</a></span><span class="op">(</span><span class="va">Path2Data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                           rawDat <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># retrieve some data specifically related to the dataset (the timeline and related temperature stored in the Data_Trex_Raw sublist)</span></span>
<span><span class="va">TRexDat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">TRexDat</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, </span>
<span>             <span class="va">TRexDat</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="st">"runTimelinef"</span><span class="op">]</span>,</span>
<span>             <span class="va">TRexDat</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="st">"Measured_Temp_Deg_C"</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># retrieve the frame rate of the video (fps)</span></span>
<span><span class="va">frameRate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">TRexDat</span><span class="op">[[</span><span class="st">"runTimelinef"</span><span class="op">]</span><span class="op">]</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">TRexDat</span><span class="op">[[</span><span class="st">"timestamps"</span><span class="op">]</span><span class="op">]</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># convert the data to a list of tracklets</span></span>
<span><span class="co"># NB: remove ntargets and timestamps because their length is lower than other variables</span></span>
<span><span class="va">trackDat</span> <span class="op">&lt;-</span> <span class="fu">MoveR</span><span class="fu">::</span><span class="fu"><a href="../reference/convert2Tracklets.html">convert2Tracklets</a></span><span class="op">(</span><span class="va">TRexDat</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">TRexDat</span><span class="op">)</span> <span class="op">==</span> <span class="st">"ntargets"</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">TRexDat</span><span class="op">)</span> <span class="op">==</span> <span class="st">"timestamps"</span><span class="op">)</span><span class="op">]</span>, by <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span></span></code></pre></div>
<p>Now we have imported the data, we can clean them to remove for instance:</p>
<ul>
<li><p>infinite values corresponding to the moments where the particles were undetected</p></li>
<li><p>probable spurious elements detected by the tracking software using several filters based on the particles size, speed, location within the arena).</p></li>
</ul>
<p>For this purpose, 3 main functions, <code><a href="../reference/filterFunc.html">filterFunc()</a></code>, <code><a href="../reference/mergeFilters.html">mergeFilters()</a></code> and <code><a href="../reference/filterTracklets.html">filterTracklets()</a></code> allow to specify custom filters, merge several filters and use them to clean the data, respectively.</p>
</div>
<div class="section level2">
<h2 id="remove-infinite-values">Remove infinite values<a class="anchor" aria-label="anchor" href="#remove-infinite-values"></a>
</h2>
<p>Infinite values are added by TRex when the particles are temporarily undetected, the following code help to remove infinite value and split the trajectories carrying them accordingly.</p>
<p>In other words, when a particle is temporarily undetected we assume that the identity of the tracklet is spurious (conservative approach), thus the function create a new tracklet with a new identity (trackletId). Nevertheless, the original identity of the particles is still conserved in the “identity” vector.</p>
<p>Because infinite values can be detected in both x and y coordinates (i.e., x.pos and y.pos) we are using <code><a href="../reference/filterFunc.html">filterFunc()</a></code> to create the filters on each variable and then <code>mergeFilter()</code> to combine the two filters.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># specify the filter to detected infinite values on "x.pos"</span></span>
<span><span class="va">filter.InfX</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">MoveR</span><span class="fu">::</span><span class="fu"><a href="../reference/filterFunc.html">filterFunc</a></span><span class="op">(</span></span>
<span>    <span class="va">trackDat</span>,</span>
<span>    toFilter <span class="op">=</span> <span class="st">"x.pos"</span>,</span>
<span>    customFunc <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/is.finite.html" class="external-link">is.infinite</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># it is also possible to group two or more filter by using the mergeFilter function</span></span>
<span><span class="co"># for instance by merging the result of several condition tests, here the detection of infinite value in "x.pos" and "y.pos".</span></span>
<span></span>
<span><span class="co">## first specify the second filter</span></span>
<span><span class="va">filter.InfY</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">MoveR</span><span class="fu">::</span><span class="fu"><a href="../reference/filterFunc.html">filterFunc</a></span><span class="op">(</span></span>
<span>    <span class="va">trackDat</span>,</span>
<span>    toFilter <span class="op">=</span> <span class="st">"y.pos"</span>,</span>
<span>    customFunc <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/is.finite.html" class="external-link">is.infinite</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co">## then merge the previously specifed filter</span></span>
<span><span class="va">filter.Inf</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">MoveR</span><span class="fu">::</span><span class="fu"><a href="../reference/mergeFilters.html">mergeFilters</a></span><span class="op">(</span>filters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">filter.InfX</span>, <span class="va">filter.InfY</span><span class="op">)</span>,</span>
<span>                     cond <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Now, that the filter is properly specified the dataset can be filtered to remove infinite values detected on both x and y coordinates using <code><a href="../reference/filterTracklets.html">filterTracklets()</a></code>.</p>
<p class="notes">
Note that in case a particle is lost and detected again during a very short time period, the function may return small tracklets which may be considered useless. These small tracklets can be removed by specifying the minimum duration above which tracklet should be kept using the <code>minDur</code> argument.
</p>
<p>For this example, we are keeping only the tracklets lasting more than one second by setting minDur to 25 frames which correspond to 1 second, or to the frame rate of the video (hence we can use the frameRate object defined above).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># filter infinite values according to the previously specified filters</span></span>
<span><span class="co"># here we are also removing the tracklets that are shorter than 25 frames (1 second) using the minDur argument.</span></span>
<span><span class="va">trackDat.Infilt</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">MoveR</span><span class="fu">::</span><span class="fu"><a href="../reference/filterTracklets.html">filterTracklets</a></span><span class="op">(</span><span class="va">trackDat</span>,</span>
<span>                     filter <span class="op">=</span> <span class="va">filter.Inf</span>,</span>
<span>                     splitCond <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                     minDur <span class="op">=</span> <span class="va">frameRate</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># display the summary of the filtering process</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">trackDat.Infilt</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## List of 8</span></span>
<span><span class="co">##  $ Tracknb_before_filter         : int 88</span></span>
<span><span class="co">##  $ Tracknb_after_filter          : int 165583</span></span>
<span><span class="co">##  $ Tracknb_after_minDur          : int 6724</span></span>
<span><span class="co">##  $ TotTrackDuration_before_filter: int 4716398</span></span>
<span><span class="co">##  $ TotTrackDuration_after_filter : int 1664533</span></span>
<span><span class="co">##  $ TotTrackDuration_after_minDur : int 1177729</span></span>
<span><span class="co">##  $ %Data_kept_after_filter       : num 35.3</span></span>
<span><span class="co">##  $ %Data_kept_after_minDur       : num 25</span></span></code></pre>
<p>The function output correspond to a list containing 2 sublists:</p>
<ul>
<li><p>the first one being a summary of the filtering process</p></li>
<li><p>the second containing the list of filtered tracklets which can be used for further computation</p></li>
</ul>
<p>See the help page of the function for more details (<code><a href="../reference/filterTracklets.html">filterTracklets()</a></code>)</p>
<p>According to the summary of the filtering process the number of tracklet drastically increases after the filtering (Tracknb_before_filter = 88 -&gt; Tracknb_after_filter = 165583 tracklets). However a large amount appears to be very short which may be due to punctual detection of an individual over the timeline.</p>
<p>This observation is confirmed because specifying the <code>minDur</code> argument removed an important part of these tracklets (Tracknb_after_filter = 165583 -&gt; Tracknb_after_minDur = 6989 tracklets).</p>
<p>Hence, there is a lot of moments where the micro-wasps were undetected within the dataset. As results, the filtering removed 64.7% (100-35.3) of the data corresponding to infinite values and then removed another 10.2% (35.3-25.1) because the resulting tracklets were shorter than 1 second (25 frames).</p>
<p>Now that we have removed the infinite values from the dataset, we can identify spurious detection by filtering on particles size.</p>
</div>
<div class="section level2">
<h2 id="filter-based-on-particles-size">Filter based on particles size<a class="anchor" aria-label="anchor" href="#filter-based-on-particles-size"></a>
</h2>
<p>To remove the spurious detection of particles generated over the video-tracking procedure, one cleaning step can consist on removing all the moment when a particles’ size is lower or higher than a given threshold (e.g., the known size of the animals).</p>
<p>We first retrieve the scaling of the video using the diameter of the circular arena measuring 2.5cm and it’s length in pixels.</p>
<p>Then, we know that <em>Trichogramma</em>’s body length is generally higher than 0.15mm and lower than 1mm (personal observation) we can hence use these limits to filter the particles for which the length is not included within this interval (fig. <a href="#fig:SizeClean">2</a>A&amp;B).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># the scaling of the video - 1 cm represent 413.4 pixels (measured using the arena diameter -2.5cm- and ImageJ)</span></span>
<span><span class="va">scaling</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="fl">413.4</span></span>
<span></span>
<span><span class="co"># the upper and lower limits to filter on particles length, according to the scale (expressed in cm)</span></span>
<span><span class="va">LengthLim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.015</span>, <span class="fl">0.1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># convert the previously filtered data into a list to ease particle's size conversion (from pixels to cm)</span></span>
<span><span class="va">trackDat.InfiltList</span> <span class="op">&lt;-</span>  <span class="fu">MoveR</span><span class="fu">::</span><span class="fu"><a href="../reference/convert2List.html">convert2List</a></span><span class="op">(</span><span class="va">trackDat.Infilt</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use analyseTracklets function to scale the length of the particles (maj.ax) in cm by iterating over the tracklets</span></span>
<span><span class="va">trackDat2</span> <span class="op">&lt;-</span> <span class="fu">MoveR</span><span class="fu">::</span><span class="fu"><a href="../reference/analyseTracklets.html">analyseTracklets</a></span><span class="op">(</span><span class="va">trackDat.Infilt</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                                     customFunc <span class="op">=</span></span>
<span>                                       <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>indLengthcm <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">[[</span><span class="st">"maj.ax"</span><span class="op">]</span><span class="op">]</span> <span class="op">*</span> <span class="va">scaling</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot the distribution of particles' length (log10) and the size limits</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="fu">MoveR</span><span class="fu">::</span><span class="fu"><a href="../reference/convert2List.html">convert2List</a></span><span class="op">(</span><span class="va">trackDat2</span><span class="op">)</span><span class="op">[[</span><span class="st">"indLengthcm"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,</span>
<span>     breaks <span class="op">=</span> <span class="fl">50</span>,</span>
<span>     main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Particles' length (log10) and \ntreshold (cm)= "</span>, <span class="va">LengthLim</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="st">"; "</span>, <span class="va">LengthLim</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Particles' length (log10)"</span>,</span>
<span>     cex.main <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">LengthLim</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"firebrick"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">substitute</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu">bold</span><span class="op">(</span><span class="st">"A"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, side <span class="op">=</span> <span class="fl">3</span>, line <span class="op">=</span> <span class="fl">0</span>, adj <span class="op">=</span> <span class="fl">0</span>, padj <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create the filter</span></span>
<span><span class="va">filter.length</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">MoveR</span><span class="fu">::</span><span class="fu"><a href="../reference/filterFunc.html">filterFunc</a></span><span class="op">(</span></span>
<span>    <span class="va">trackDat2</span>,</span>
<span>    toFilter <span class="op">=</span> <span class="st">"indLengthcm"</span>,</span>
<span>    customFunc <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>      <span class="va">x</span> <span class="op">&lt;</span> <span class="va">LengthLim</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">|</span> <span class="va">x</span> <span class="op">&gt;</span> <span class="va">LengthLim</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># apply the filter on the data using the frame rate as minimum duration of the tracklets</span></span>
<span><span class="va">trackDat.lenfilt</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">MoveR</span><span class="fu">::</span><span class="fu"><a href="../reference/filterTracklets.html">filterTracklets</a></span><span class="op">(</span><span class="va">trackDat2</span>,</span>
<span>                     <span class="va">filter.length</span>,</span>
<span>                     splitCond <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                     minDur <span class="op">=</span> <span class="va">frameRate</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot the distribution of particles' length (log10) after the filtering</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="fu">MoveR</span><span class="fu">::</span><span class="fu"><a href="../reference/convert2List.html">convert2List</a></span><span class="op">(</span><span class="va">trackDat.lenfilt</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">$</span><span class="va">maj.ax</span><span class="op">)</span>,</span>
<span>     breaks <span class="op">=</span> <span class="fl">50</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"Particles' length (log10) \nafter filtering"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Particles' length (log10)"</span>,</span>
<span>     cex.main <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">substitute</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu">bold</span><span class="op">(</span><span class="st">"B"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, side <span class="op">=</span> <span class="fl">3</span>, line <span class="op">=</span> <span class="fl">0</span>, adj <span class="op">=</span> <span class="fl">0</span>, padj <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:SizeClean"></span>
<img src="MoveR-Clean-FilterData_files/figure-html/SizeClean-1.png" alt="Histogram of the Log-transformed length of the particles and specified limits (vertical lines corresponding to 0.015 and 0.1 cm) of the distribution before (A) and after the filtering process (B) removing the moments where the particles' length is below or above the specified limits." width="100%"><p class="caption">
Figure 2: Histogram of the Log-transformed length of the particles and specified limits (vertical lines corresponding to 0.015 and 0.1 cm) of the distribution before (A) and after the filtering process (B) removing the moments where the particles’ length is below or above the specified limits.
</p>
</div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># display the information about the filtering process (see ??filterTracklets())</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">trackDat.lenfilt</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## List of 8</span></span>
<span><span class="co">##  $ Tracknb_before_filter         : int 6724</span></span>
<span><span class="co">##  $ Tracknb_after_filter          : int 13997</span></span>
<span><span class="co">##  $ Tracknb_after_minDur          : num 5520</span></span>
<span><span class="co">##  $ TotTrackDuration_before_filter: int 1177729</span></span>
<span><span class="co">##  $ TotTrackDuration_after_filter : int 1133835</span></span>
<span><span class="co">##  $ TotTrackDuration_after_minDur : int 1104334</span></span>
<span><span class="co">##  $ %Data_kept_after_filter       : num 96.3</span></span>
<span><span class="co">##  $ %Data_kept_after_minDur       : num 93.8</span></span></code></pre>
<p>According to the summary of the filtering step based on particles’ size, the amount of data removed by the filtering is reasonable with 3.7% of data considered above or below the particles’ length threshold.</p>
<p>However, the filter splited some tracklets in small part resulting in an additional 2.5% of data removed because resulting tracklets were shorter than 1 second (25 frames).</p>
<p>While the size of the particles is a good way to remove potential spurious detection, another efficient way to filter the data is based on the particles’ speed.</p>
</div>
<div class="section level2">
<h2 id="filter-based-on-particles-speed">Filter based on particles speed<a class="anchor" aria-label="anchor" href="#filter-based-on-particles-speed"></a>
</h2>
<p>Indeed, the particles’ speed can be a good indicator of spurious detection or particle identification. More particularly, When the speed of a particle is too high (and have hence no biological meaning) it can be due to change in particle identity or more generally tracking artifact.</p>
<p>However, While the data can be filtered based data that already exist into the raw output of the tracking software, here the speed of the particles is not included, and in any case it should be recomputed since we have modified the tracklets over the previous filtering processes.</p>
<p>For the sacks of this example we will use the 999<sup>th</sup> percentile as a treshold above which particles’ speed are considered artifactual.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># retrieve the previously filtered data and used them to compute particles' speed</span></span>
<span><span class="va">trackDat3</span> <span class="op">&lt;-</span> <span class="va">trackDat.lenfilt</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Use analyseTracklets function to compute the speed of the particles by iterating over the tracklets</span></span>
<span><span class="co"># here we use the "speed()" modulus to compute the speed over each tracklet</span></span>
<span><span class="va">trackDat3</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">MoveR</span><span class="fu">::</span><span class="fu"><a href="../reference/analyseTracklets.html">analyseTracklets</a></span><span class="op">(</span><span class="va">trackDat3</span>,</span>
<span>                      customFunc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>                        speed <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>                          <span class="fu">MoveR</span><span class="fu">::</span><span class="fu"><a href="../reference/speed.html">speed</a></span><span class="op">(</span></span>
<span>                            <span class="va">x</span>,</span>
<span>                            timeCol <span class="op">=</span> <span class="st">"runTimelinef"</span>,</span>
<span>                            scale <span class="op">=</span> <span class="fl">1</span></span>
<span>                          <span class="op">)</span></span>
<span>                      <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># retrieve the speed of all particles in a vector</span></span>
<span><span class="va">particleSpeed</span> <span class="op">&lt;-</span> <span class="fu">MoveR</span><span class="fu">::</span><span class="fu"><a href="../reference/convert2List.html">convert2List</a></span><span class="op">(</span><span class="va">trackDat3</span><span class="op">)</span><span class="op">[[</span><span class="st">"speed"</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># compute the 999th percentile of particles' speed (log10 transformed data)</span></span>
<span><span class="va">quant999th</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">particleSpeed</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.999</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot the particles' speed (log10) distribution and the 999th percentile before filtering</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">particleSpeed</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fl">100</span>, main <span class="op">=</span> <span class="st">"particles' speed (log10) and 999th quantile \nbefore filtering"</span>,</span>
<span>     cex.main<span class="op">=</span> <span class="fl">0.9</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Particles' speed (log10)"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="va">quant999th</span>, col <span class="op">=</span> <span class="st">"#660000"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">substitute</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu">bold</span><span class="op">(</span><span class="st">"A"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, side <span class="op">=</span> <span class="fl">3</span>, line <span class="op">=</span> <span class="fl">0</span>, adj <span class="op">=</span> <span class="fl">0</span>, padj <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># the result seem satisfactory since with this threshold we will remove only the few moments where particles speed overpass 22.5 pixels per frame while we conserve the bimodal distribution of the particles' speed.</span></span>
<span><span class="co"># hence, create the filter based on the computed 999th quantile </span></span>
<span><span class="va">filter.speed</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">MoveR</span><span class="fu">::</span><span class="fu"><a href="../reference/filterFunc.html">filterFunc</a></span><span class="op">(</span></span>
<span>    <span class="va">trackDat3</span>,</span>
<span>    toFilter <span class="op">=</span> <span class="st">"speed"</span>,</span>
<span>    customFunc <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>      <span class="va">x</span> <span class="op">&lt;</span> <span class="fl">0</span> <span class="op">|</span> <span class="va">x</span> <span class="op">&gt;</span> <span class="fl">10</span> <span class="op">^</span> <span class="va">quant999th</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># apply the filter on the data using the frame rate as minimum duration of the tracklets</span></span>
<span><span class="va">trackDat.speedfilt</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">MoveR</span><span class="fu">::</span><span class="fu"><a href="../reference/filterTracklets.html">filterTracklets</a></span><span class="op">(</span><span class="va">trackDat3</span>,</span>
<span>                     <span class="va">filter.speed</span>,</span>
<span>                     splitCond <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                     minDur <span class="op">=</span> <span class="va">frameRate</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot particles' speed (log10) distribution after the filtering</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="fu">MoveR</span><span class="fu">::</span><span class="fu"><a href="../reference/convert2List.html">convert2List</a></span><span class="op">(</span><span class="va">trackDat.speedfilt</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">[[</span><span class="st">"speed"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,</span>
<span>     breaks <span class="op">=</span> <span class="fl">100</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"Particles' speed (log10) \nafter filtering"</span>,</span>
<span>     cex.main<span class="op">=</span> <span class="fl">0.9</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Particles' speed (log10)"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">substitute</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu">bold</span><span class="op">(</span><span class="st">"B"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, side <span class="op">=</span> <span class="fl">3</span>, line <span class="op">=</span> <span class="fl">0</span>, adj <span class="op">=</span> <span class="fl">0</span>, padj <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:SpeedClean"></span>
<img src="MoveR-Clean-FilterData_files/figure-html/SpeedClean-1.png" alt="Histogram of the Log-transformed speed of the particles and 999th quantile (vertical line) of the distribution before (A) and after the filtering process (B) removing the moments where the particles' speed is above the 999th quantile." width="100%"><p class="caption">
Figure 3: Histogram of the Log-transformed speed of the particles and 999th quantile (vertical line) of the distribution before (A) and after the filtering process (B) removing the moments where the particles’ speed is above the 999th quantile.
</p>
</div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># display the information about the filtering process (see ??filterTracklets())</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">trackDat.speedfilt</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## List of 8</span></span>
<span><span class="co">##  $ Tracknb_before_filter         : int 5520</span></span>
<span><span class="co">##  $ Tracknb_after_filter          : int 6508</span></span>
<span><span class="co">##  $ Tracknb_after_minDur          : num 5803</span></span>
<span><span class="co">##  $ TotTrackDuration_before_filter: int 1104334</span></span>
<span><span class="co">##  $ TotTrackDuration_after_filter : int 1103235</span></span>
<span><span class="co">##  $ TotTrackDuration_after_minDur : int 1094875</span></span>
<span><span class="co">##  $ %Data_kept_after_filter       : num 99.9</span></span>
<span><span class="co">##  $ %Data_kept_after_minDur       : num 99.1</span></span></code></pre>
<p>According to the summary of the filtering step based on particles’ speed, the amount of data removed by the filtering is reasonable with 0.1% of data considered above the speed threshold, which is consistent with our approach since we wanted to remove only extremes values (999Th quantile, fig. <a href="#fig:SpeedClean">3</a>A&amp;B).</p>
<p>Also, the filter splited only few tracklets in small part resulting in an additional 0.8% of data removed because resulting tracklets were shorter than 1 second (25 frames).</p>
<p>Finally, it seems interesting to remove the particles that are detected outside of the arena since it should be due to tracking artifact, or more generally to unintended particles’ detection and movements.</p>
</div>
<div class="section level2">
<h2 id="filter-based-on-particles-detection-outside-the-arena">Filter based on particles detection outside the arena<a class="anchor" aria-label="anchor" href="#filter-based-on-particles-detection-outside-the-arena"></a>
</h2>
<p>Indeed, sometimes particles can be detected outside the arena, either because an individual as escaped from the arena or because the background has changed over the video recording (tracking artifact).</p>
<p>To solve this issue, it is possible to remove the parts of a tracklet that have been detected outside the arena.</p>
<p>To tackle this aim, one may either use the already implemented functions to generate the edge of circular or polygonal ROIs (see <code><a href="../reference/circles.html">circles()</a></code> and <code><a href="../reference/polygons.html">polygons()</a></code>) or retrieving the position of the arena (or any ROI) edge from a distance matrix generated trough an image processing program such as <a href="https://imagej.net/ij/index.html" class="external-link">ImageJ</a>.</p>
<p>We first need to retrieve or generate the points specifying the arena edge:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># retrieve the location of the arena edge from a distance matrix generated using color tresholding in imageJ</span></span>
<span><span class="co"># as color tresholding returns a matrix with image resolution (x in rows and y in columns) and increasing distance to the edge of the arena, here the edge correspond </span></span>
<span><span class="co"># to the lower value of the distance matrix (i.e., 1).</span></span>
<span><span class="co"># Also specifying the order argument as TRUE ensure that the points delimiting the arena edge are sorted clockwise, making easy to draw the edge.</span></span>
<span><span class="va">edge</span> <span class="op">&lt;-</span> <span class="fu">MoveR</span><span class="fu">::</span><span class="fu"><a href="../reference/locROI.html">locROI</a></span><span class="op">(</span><span class="va">Path2Data</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, edgeCrit <span class="op">=</span> <span class="fl">1</span>, xy <span class="op">=</span> <span class="fl">1</span>, order <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="co"># here the coordinates of the arena edge are stored in the edge object</span></span>
<span></span>
<span><span class="co"># it is then easy to draw the arena edge</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="cn">NULL</span>, </span>
<span>     xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">edge</span><span class="op">[</span>, <span class="st">"x.pos"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>, </span>
<span>     ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">edge</span><span class="op">[</span>, <span class="st">"y.pos"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Video width (pixels)"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"Video height (pixels)"</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"Edge and centre of the arena"</span>,</span>
<span>     cex.main <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html" class="external-link">polygon</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">edge</span><span class="op">[[</span><span class="st">"x.pos"</span><span class="op">]</span><span class="op">]</span>, <span class="va">edge</span><span class="op">[[</span><span class="st">"y.pos"</span><span class="op">]</span><span class="op">]</span>, lty <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/adjustcolor.html" class="external-link">adjustcolor</a></span><span class="op">(</span><span class="st">"firebrick"</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># As well as the center of the arena</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">edge</span><span class="op">[[</span><span class="st">"x.pos"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">edge</span><span class="op">[[</span><span class="st">"y.pos"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  col <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  cex <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Note that, in the case of a circular arena, by knowing the coordinates of the center of the arena and the length of the diameter (2.5cm) allows to generate the coordinates of the border of the arena using the circles() function from the MoveR package. Similar method can also be used for polygonal shape using the polygons() function from the MoveR package.</span></span>
<span><span class="va">ArenaEdge</span> <span class="op">&lt;-</span> <span class="fu">MoveR</span><span class="fu">::</span><span class="fu"><a href="../reference/circles.html">circles</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">edge</span><span class="op">[[</span><span class="st">"x.pos"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">edge</span><span class="op">[[</span><span class="st">"y.pos"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  radius <span class="op">=</span> <span class="fl">2.5</span> <span class="op">/</span> <span class="fl">2</span> <span class="op">/</span> <span class="va">scaling</span>, <span class="co"># here the radius of the arena is 2.5cm/2 divided by the scaling to obtain the value in pixels</span></span>
<span>  border <span class="op">=</span> <span class="st">"firebrick"</span>,</span>
<span>  draw <span class="op">=</span> <span class="cn">T</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:edgeDef"></span>
<img src="MoveR-Clean-FilterData_files/figure-html/edgeDef-1.png" alt="Representation of centre and edge of the arena retrieved from a distance matrix generated using color tresholding in imageJ. The position of the arena edge can be extracted from the distance matrix as the lowest value of distance matrix (i.e., 1) and the centre of the arena as the mean of the edge x and y coordinates." width="100%"><p class="caption">
Figure 4: Representation of centre and edge of the arena retrieved from a distance matrix generated using color tresholding in imageJ. The position of the arena edge can be extracted from the distance matrix as the lowest value of distance matrix (i.e., 1) and the centre of the arena as the mean of the edge x and y coordinates.
</p>
</div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># here the coordinates of the arena edge are then stored in the ArenaEdge object</span></span></code></pre></div>
<p>Here the distance matrix generated using <a href="https://imagej.net/ij/index.html" class="external-link">ImageJ</a> returns decreasing distance from the centre of the arena to the edge.</p>
<p>Accordingly, the lowest value (i.e., 1) corresponds to the edge of the arena (fig. <a href="#fig:edgeDef">4</a>, black line). Hence, the use of a distance matrix may be a a good option to retrieve the location of the edge of an arena or any ROI, whatever its shape.</p>
<p>However, in the case of using a classic circular or polygonal arena a simpler approach would consist of generating the expected arena edge using <code><a href="../reference/circles.html">circles()</a></code> or <code><a href="../reference/polygons.html">polygons()</a></code> and feeding the former with coordinates of the arena center and the radius length (fig. <a href="#fig:edgeDef">4</a>, red line).</p>
<p>We can then easily identify whether a particle is detect within or outside the arena by assigning the ROI to each tracklet using the <code><a href="../reference/assignROI.html">assignROI()</a></code> and filtering out the tracklets parts detected outside the arena.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## assign The ROI (here the arena) to the particles' positions</span></span>
<span><span class="va">trackDat4</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">MoveR</span><span class="fu">::</span><span class="fu"><a href="../reference/analyseTracklets.html">analyseTracklets</a></span><span class="op">(</span><span class="va">trackDat.speedfilt</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                          customFunc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>                            Arena <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>                              <span class="fu">MoveR</span><span class="fu">::</span><span class="fu"><a href="../reference/assignROI.html">assignROI</a></span><span class="op">(</span></span>
<span>                                <span class="va">x</span>,</span>
<span>                                ROIs <span class="op">=</span> <span class="va">edge</span>,</span>
<span>                                edgeInclude <span class="op">=</span> <span class="cn">F</span>,</span>
<span>                                order <span class="op">=</span> <span class="cn">T</span></span>
<span>                              <span class="op">)</span></span>
<span>                          <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># draw the tracklet and the arena edges </span></span>
<span><span class="fu">MoveR</span><span class="fu">::</span><span class="fu"><a href="../reference/drawTracklets.html">drawTracklets</a></span><span class="op">(</span><span class="va">trackDat4</span>,</span>
<span>                     timeCol <span class="op">=</span> <span class="st">"runTimelinef"</span>,</span>
<span>                     add2It <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html" class="external-link">polygon</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">edge</span><span class="op">$</span><span class="va">x.pos</span>, y <span class="op">=</span> <span class="va">edge</span><span class="op">$</span><span class="va">y.pos</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:edgeClean"></span>
<img src="MoveR-Clean-FilterData_files/figure-html/edgeClean-1.png" alt="Micro-wasps trajectories over the whole video timeline, expressed in frame. The arena edges are represented by the black circle." width="100%"><p class="caption">
Figure 5: Micro-wasps trajectories over the whole video timeline, expressed in frame. The arena edges are represented by the black circle.
</p>
</div>
<p>Apparently the amount of artifact detected outside the arena is null or very low (see fig. <a href="#fig:edgeClean">5</a>. However, by using <code><a href="../reference/assignROI.html">assignROI()</a></code> and excluding the edge some tracklet part are indeed detected outside the arena.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create the filter to remove particles outside the arena</span></span>
<span><span class="va">filter.out</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">MoveR</span><span class="fu">::</span><span class="fu"><a href="../reference/filterFunc.html">filterFunc</a></span><span class="op">(</span></span>
<span>    <span class="va">trackDat4</span>,</span>
<span>    toFilter <span class="op">=</span> <span class="st">"Arena"</span>,</span>
<span>    customFunc <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>      <span class="va">x</span> <span class="op">==</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># apply the filter on the data using the frame rate as minimum duration of the tracklets</span></span>
<span><span class="va">trackDat.borderfilt</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">MoveR</span><span class="fu">::</span><span class="fu"><a href="../reference/filterTracklets.html">filterTracklets</a></span><span class="op">(</span><span class="va">trackDat4</span>,</span>
<span>              <span class="va">filter.out</span>,</span>
<span>              splitCond <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>              minDur <span class="op">=</span> <span class="va">frameRate</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in MoveR::filterTracklets(trackDat4, filter.out, splitCond = TRUE, : For Tracklet_2: </span></span>
<span><span class="co">## All the new tracklets created after filtering are shorter than minDur, no tracklet returned</span></span></code></pre>
<pre><code><span><span class="co">## Warning in MoveR::filterTracklets(trackDat4, filter.out, splitCond = TRUE, : For Tracklet_3724: </span></span>
<span><span class="co">## All the new tracklets created after filtering are shorter than minDur, no tracklet returned</span></span></code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># rename the cleaned dataset for further use</span></span>
<span><span class="va">trackDat5</span> <span class="op">&lt;-</span> <span class="va">trackDat.borderfilt</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># check that the particle detected outside has been removed</span></span>
<span><span class="co">## retrieve the ROI assignation before and after filtering</span></span>
<span><span class="va">compar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  before <span class="op">=</span> <span class="fu">MoveR</span><span class="fu">::</span><span class="fu"><a href="../reference/convert2List.html">convert2List</a></span><span class="op">(</span><span class="va">trackDat4</span><span class="op">)</span><span class="op">[[</span><span class="st">"Arena"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  after <span class="op">=</span> <span class="fu">MoveR</span><span class="fu">::</span><span class="fu"><a href="../reference/convert2List.html">convert2List</a></span><span class="op">(</span><span class="va">trackDat5</span><span class="op">)</span><span class="op">[[</span><span class="st">"Arena"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">## create a count table to determine the amount of tracklets parts that are within and outside the arena</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow <span class="op">=</span> <span class="fl">2</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">compar</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">compar</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">compar</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">res</span><span class="op">[</span><span class="va">i</span>, <span class="st">"ROI_1"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"\\&lt;ROI_1\\&gt;"</span>, <span class="va">compar</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">res</span><span class="op">[</span><span class="va">i</span>, <span class="st">"FALSE"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"\\&lt;FALSE\\&gt;"</span>, <span class="va">compar</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">res</span></span></code></pre></div>
<pre><code><span><span class="co">##          ROI_1 FALSE</span></span>
<span><span class="co">## before 1094821    54</span></span>
<span><span class="co">## after  1094821     0</span></span></code></pre>
<p>Then, as expected the filtering step based the location of the particles inside or outside the arena have removed parts of the tracklets (54 occurrences) detected outside the arena (ROI_1).</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># display the information about the filtering process (see ??filterTracklets())</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">trackDat.borderfilt</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## List of 8</span></span>
<span><span class="co">##  $ Tracknb_before_filter         : int 5803</span></span>
<span><span class="co">##  $ Tracknb_after_filter          : int 5803</span></span>
<span><span class="co">##  $ Tracknb_after_minDur          : num 5801</span></span>
<span><span class="co">##  $ TotTrackDuration_before_filter: int 1094875</span></span>
<span><span class="co">##  $ TotTrackDuration_after_filter : int 1094823</span></span>
<span><span class="co">##  $ TotTrackDuration_after_minDur : int 1094821</span></span>
<span><span class="co">##  $ %Data_kept_after_filter       : num 100</span></span>
<span><span class="co">##  $ %Data_kept_after_minDur       : num 100</span></span></code></pre>
<p>In addition, according to the summary of the filtering step, the amount of data removed by the filtering is very low (&lt;0.1%), confirming that there is few tracking artifact outside of the arena (fig. <a href="#fig:edgeClean">5</a>).</p>
<p>Accordingly, the filter splited only few tracklets in small part resulting in less than 0.1% of data removed because resulting tracklets were shorter than 1 second (25 frames).</p>
<p>While the count table and the summary of the filtering give a general quantitative view of the amount of data removed by the filtering step one may also want to have an idea of the tracklets identity and the spatio-temporal distribution of the removed data. For this we can use <code><a href="../reference/drawTracklets.html">drawTracklets()</a></code> as follow:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># identify the part of the tracklets that are detected outside the arena</span></span>
<span><span class="va">trackDat4List</span> <span class="op">&lt;-</span> <span class="fu">MoveR</span><span class="fu">::</span><span class="fu"><a href="../reference/convert2List.html">convert2List</a></span><span class="op">(</span><span class="va">trackDat4</span><span class="op">)</span></span>
<span><span class="va">OutTracklets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">trackDat4List</span><span class="op">[[</span><span class="st">"trackletId"</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">trackDat4List</span><span class="op">[[</span><span class="st">"Arena"</span><span class="op">]</span><span class="op">]</span> <span class="op">==</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">OutTracklets</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Tracklet_2"    "Tracklet_3724"</span></span></code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># identify the part of the tracklets that are detected outside the arena</span></span>
<span><span class="va">trackDat4List</span> <span class="op">&lt;-</span> <span class="fu">MoveR</span><span class="fu">::</span><span class="fu"><a href="../reference/convert2List.html">convert2List</a></span><span class="op">(</span><span class="va">trackDat4</span><span class="op">)</span></span>
<span><span class="va">OutTracklets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">trackDat4List</span><span class="op">[[</span><span class="st">"trackletId"</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">trackDat4List</span><span class="op">[[</span><span class="st">"Arena"</span><span class="op">]</span><span class="op">]</span> <span class="op">==</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">OutTracklets</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Tracklet_2"    "Tracklet_3724"</span></span></code></pre>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot them</span></span>
<span><span class="fu">MoveR</span><span class="fu">::</span><span class="fu"><a href="../reference/drawTracklets.html">drawTracklets</a></span><span class="op">(</span></span>
<span>  <span class="va">trackDat4</span>,</span>
<span>  selTrack <span class="op">=</span> <span class="va">OutTracklets</span>,</span>
<span>  main <span class="op">=</span> ,</span>
<span>  cex.main <span class="op">=</span> <span class="fl">0.9</span>,</span>
<span>  cex.start <span class="op">=</span> <span class="fl">1</span>, <span class="co"># increase the size of the start points of the tracklet (help to locate it, particularly if the particle is still)</span></span>
<span>  add2It <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html" class="external-link">polygon</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">edge</span><span class="op">$</span><span class="va">x.pos</span>, y <span class="op">=</span> <span class="va">edge</span><span class="op">$</span><span class="va">y.pos</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:edgeCleanBeforeAfter"></span>
<img src="MoveR-Clean-FilterData_files/figure-html/edgeCleanBeforeAfter-1.png" alt="Representation of the particles' trajectories detected outside the arena before the filtering process removing the moments where the particles are detected outside of the arena." width="100%"><p class="caption">
Figure 6: Representation of the particles’ trajectories detected outside the arena before the filtering process removing the moments where the particles are detected outside of the arena.
</p>
</div>
<p>Here we can see that the tracklets’ part detected outside the arena belong to two tracklets that stayed still over the video-recording (“Tracklet_2” and “Tracklet_3724”). We can thus be confident about the fact that it should be considered as tracking artifacts.</p>
<p>Now we have achieved the filtering of the dataset, one would take a look and eventually save a summary of the filtering procedure.</p>
</div>
<div class="section level2">
<h2 id="filteringcleaning-summary">Filtering/Cleaning summary<a class="anchor" aria-label="anchor" href="#filteringcleaning-summary"></a>
</h2>
<p>Once the filtering/cleaning steps are done, the various filter summaries can be retrieved and easily grouped and eventually saved.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create a summary of each filter results </span></span>
<span><span class="va">FilterSummary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="st">"cbind"</span>,</span>
<span>                         <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>                           <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Infilt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">trackDat.Infilt</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                           <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>lenfilt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">trackDat.lenfilt</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                           <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>speedfilt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">trackDat.speedfilt</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                           <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>outfilt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">trackDat.borderfilt</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>                         <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># add cumulative_%Data_kept_after_filter and after_minDur</span></span>
<span><span class="va">FilterSummary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">FilterSummary</span>, </span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">FilterSummary</span>, <span class="fl">2</span>, FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span><span class="op">/</span><span class="va">FilterSummary</span><span class="op">[</span><span class="fl">4</span>,<span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="fl">100</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">FilterSummary</span>, <span class="fl">2</span>, FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span><span class="op">/</span><span class="va">FilterSummary</span><span class="op">[</span><span class="fl">4</span>,<span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">FilterSummary</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">9</span>,<span class="fl">10</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cumulative_%Data_kept_after_filter"</span>, </span>
<span>                                      <span class="st">"cumulative_%Data_kept_after_minDur"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">FilterSummary</span></span></code></pre></div>
<pre><code><span><span class="co">##                                          Infilt      lenfilt    speedfilt</span></span>
<span><span class="co">## Tracknb_before_filter              8.800000e+01 6.724000e+03 5.520000e+03</span></span>
<span><span class="co">## Tracknb_after_filter               1.655830e+05 1.399700e+04 6.508000e+03</span></span>
<span><span class="co">## Tracknb_after_minDur               6.724000e+03 5.520000e+03 5.803000e+03</span></span>
<span><span class="co">## TotTrackDuration_before_filter     4.716398e+06 1.177729e+06 1.104334e+06</span></span>
<span><span class="co">## TotTrackDuration_after_filter      1.664533e+06 1.133835e+06 1.103235e+06</span></span>
<span><span class="co">## TotTrackDuration_after_minDur      1.177729e+06 1.104334e+06 1.094875e+06</span></span>
<span><span class="co">## %Data_kept_after_filter            3.529246e+01 9.627300e+01 9.990048e+01</span></span>
<span><span class="co">## %Data_kept_after_minDur            2.497094e+01 9.376809e+01 9.914347e+01</span></span>
<span><span class="co">## cumulative_%Data_kept_after_filter 3.529246e+01 2.404027e+01 2.339147e+01</span></span>
<span><span class="co">## cumulative_%Data_kept_after_minDur 2.497094e+01 2.341478e+01 2.321422e+01</span></span>
<span><span class="co">##                                         outfilt</span></span>
<span><span class="co">## Tracknb_before_filter              5.803000e+03</span></span>
<span><span class="co">## Tracknb_after_filter               5.803000e+03</span></span>
<span><span class="co">## Tracknb_after_minDur               5.801000e+03</span></span>
<span><span class="co">## TotTrackDuration_before_filter     1.094875e+06</span></span>
<span><span class="co">## TotTrackDuration_after_filter      1.094823e+06</span></span>
<span><span class="co">## TotTrackDuration_after_minDur      1.094821e+06</span></span>
<span><span class="co">## %Data_kept_after_filter            9.999525e+01</span></span>
<span><span class="co">## %Data_kept_after_minDur            9.999507e+01</span></span>
<span><span class="co">## cumulative_%Data_kept_after_filter 2.321312e+01</span></span>
<span><span class="co">## cumulative_%Data_kept_after_minDur 2.321307e+01</span></span></code></pre>
<p>As previously stated, we can indeed see that the filter based on infinite values have removed a lot of data contrary to the other filters. Also, it seems that the minimum duration of the tracklets set to 25 frames (1 second) is appropriate since it remove a small amount of data.</p>
<p>It is also possible to display a summary of the tracking information of both the initial dataset (i.e., trackDat) and the filtered/cleaned one (trackDat5) using <code><a href="../reference/trackStats.html">trackStats()</a></code> to quickly compare them.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># compute and display a detailed summary of the tracking information before and after cleaning (see ??trackStats())</span></span>
<span><span class="va">Data_Trex_stats_before_filter</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">MoveR</span><span class="fu">::</span><span class="fu"><a href="../reference/trackStats.html">trackStats</a></span><span class="op">(</span><span class="va">trackDat</span>,</span>
<span>                    frameR <span class="op">=</span> <span class="va">frameRate</span>,</span>
<span>                    scale <span class="op">=</span> <span class="va">scaling</span>,</span>
<span>                    unit <span class="op">=</span> <span class="st">"cm"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## List of 2</span></span>
<span><span class="co">##  $ VideoSummary   :List of 4</span></span>
<span><span class="co">##   ..$ videoDuration_f: num 105138</span></span>
<span><span class="co">##   ..$ videoDuration_s: num 4206</span></span>
<span><span class="co">##   ..$ frameR         : num 25</span></span>
<span><span class="co">##   ..$ scale          : num 0.00242</span></span>
<span><span class="co">##  $ TrackletSummary:List of 8</span></span>
<span><span class="co">##   ..$ trackNb           : int 88</span></span>
<span><span class="co">##   ..$ totTrackDuration_f: int 4716398</span></span>
<span><span class="co">##   ..$ totTrackDuration_s: num 188656</span></span>
<span><span class="co">##   ..$ totTrackLength_cm : num NaN</span></span>
<span><span class="co">##   ..$ trackletId        : chr [1:88] "434" "435" "436" "437" ...</span></span>
<span><span class="co">##   ..$ trackDuration_f   : int [1:88] 12074 12079 12079 12079 12079 12083 12084 12084 12084 12084 ...</span></span>
<span><span class="co">##   ..$ trackDuration_s   : num [1:88] 483 483 483 483 483 ...</span></span>
<span><span class="co">##   ..$ trackLength_cm    : num [1:88] NaN NaN NaN NaN NaN NaN NaN NaN NaN NaN ...</span></span></code></pre>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Data_Trex_stats_after_filter</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">MoveR</span><span class="fu">::</span><span class="fu"><a href="../reference/trackStats.html">trackStats</a></span><span class="op">(</span><span class="va">trackDat5</span>,</span>
<span>                    frameR <span class="op">=</span> <span class="va">frameRate</span>,</span>
<span>                    scale <span class="op">=</span> <span class="va">scaling</span>,</span>
<span>                    unit <span class="op">=</span> <span class="st">"cm"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## List of 2</span></span>
<span><span class="co">##  $ VideoSummary   :List of 4</span></span>
<span><span class="co">##   ..$ videoDuration_f: num 105138</span></span>
<span><span class="co">##   ..$ videoDuration_s: num 4206</span></span>
<span><span class="co">##   ..$ frameR         : num 25</span></span>
<span><span class="co">##   ..$ scale          : num 0.00242</span></span>
<span><span class="co">##  $ TrackletSummary:List of 8</span></span>
<span><span class="co">##   ..$ trackNb           : int 5801</span></span>
<span><span class="co">##   ..$ totTrackDuration_f: int 1094821</span></span>
<span><span class="co">##   ..$ totTrackDuration_s: num 43793</span></span>
<span><span class="co">##   ..$ totTrackLength_cm : num 7716</span></span>
<span><span class="co">##   ..$ trackletId        : chr [1:5801] "Tracklet_1" "Tracklet_2" "Tracklet_3" "Tracklet_4" ...</span></span>
<span><span class="co">##   ..$ trackDuration_f   : int [1:5801] 138 32 41 60 43 88 46 338 530 255 ...</span></span>
<span><span class="co">##   ..$ trackDuration_s   : num [1:5801] 5.52 1.28 1.64 2.4 1.72 ...</span></span>
<span><span class="co">##   ..$ trackLength_cm    : num [1:5801] 0.059 0.0777 0.0182 0.0261 0.0126 ...</span></span></code></pre>
<p>By comparing the summary of the tracking information before and after the filtering process, we can see that video characteristics are unchanged.</p>
<p>On the contrary, tracklets are more numerous and shorter after the filtering than before which is not surprising since we have removed biased data and splited the tracklets accordingly.</p>
<p>Both kind of summaries can then be saved as a .csv file using common function such as <code><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">utils::write.csv()</a></code> or <code><a href="https://Rdatatable.gitlab.io/data.table/reference/fwrite.html" class="external-link">data.table::fwrite()</a></code>.</p>
<p>Also, the filtered dataset can be saved before using it for further computations.
As such dataset can be large we recommend to use <code><a href="https://Rdatatable.gitlab.io/data.table/reference/fwrite.html" class="external-link">data.table::fwrite()</a></code> from the data.table package as well as saving the data as .gz archive to save as much disk space as possible (e.g., For this dataset: .csv = 181Mo vs .csv.gz = 62Mo).</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># save the cleaned dataset as .csv compressed as .gz</span></span>
<span><span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fwrite.html" class="external-link">fwrite</a></span><span class="op">(</span></span>
<span>  <span class="fu">MoveR</span><span class="fu">::</span><span class="fu"><a href="../reference/convert2List.html">convert2List</a></span><span class="op">(</span><span class="va">trackDat5</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">dirname</a></span><span class="op">(</span><span class="va">Path2Data</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>, <span class="st">"cleanedData"</span>, sep <span class="op">=</span> <span class="st">"/"</span></span>
<span>  <span class="op">)</span>, <span class="st">"csv"</span>, <span class="st">"gz"</span>, sep <span class="op">=</span> <span class="st">"."</span><span class="op">)</span>,</span>
<span>  sep <span class="op">=</span> <span class="st">";"</span>,</span>
<span>  dec <span class="op">=</span> <span class="st">"."</span>,</span>
<span>  na <span class="op">=</span> <span class="st">"NA"</span>,</span>
<span><span class="op">)</span></span></code></pre></div>
<p>Now that the filtering/cleaning process is achieved, we can move to data analysis through various metrics computations.</p>
<p class="notes">
Note, however, that ones would add or replace some of the filters that have been used in this example depending on the model species and the study’ aims. Accordingly, the various function developed in the MoveR package are very flexible and allow the user to specify custom functions to break limits.
</p>
<p>For more insight how to use MoveR to run further computation check the next tutorials.</p>
<p><strong>Happy coding.</strong></p>
<p><a href="https://qpetitjean.github.io/MoveR/articles/MoveR-ImportData.html" class="external-link previous">« Previous</a><a href="https://qpetitjean.github.io/MoveR/articles/MoveR-ComputeMetrics.html" class="external-link next">Next »</a><br></p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ul>
<li><p>Ion Scotta, M., Margris, L., Sellier, N., Warot, S., Gatti, F., Siccardi, F., Gibert, P., Vercken, E., Ris, N., 2021. Genetic Variability, Population Differentiation, and Correlations for Thermal Tolerance Indices in the Minute Wasp, Trichogramma cacoeciae. Insects 12, 1013. <a href="https://doi.org/10.3390/insects12111013" class="external-link uri">https://doi.org/10.3390/insects12111013</a></p></li>
<li><p>Walter, T., Couzin, I.D., 2021. TRex, a fast multi-animal tracking system with markerless identification, and 2D estimation of posture and visual fields. eLife 10, e64000. <a href="https://doi.org/10.7554/eLife.64000" class="external-link uri">https://doi.org/10.7554/eLife.64000</a></p></li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://qpetitjean.github.io/qpetitjean_distill/" class="external-link">Quentin PETITJEAN</a>, <a href="https://vcalcagnoresearch.wordpress.com/" class="external-link">Vincent CALCAGNO</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
